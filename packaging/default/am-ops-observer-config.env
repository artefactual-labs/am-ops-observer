# /etc/am-ops-observer/config.env
#
# Main non-secret configuration for am-ops-observer.
# This file is loaded when APP_CONFIG_FILE points here (default behavior).
#
# Note: real OS environment variables always override file values.

# -----------------------------------------------------------------------------
# HTTP server options
# -----------------------------------------------------------------------------

# Listen address for UI/API/metrics endpoints.
# Examples: ":8080", "127.0.0.1:8080", "0.0.0.0:8080"
APP_LISTEN_ADDR=":8080"

# HTTP timeout tuning (seconds).
APP_READ_TIMEOUT_SEC="10"
APP_WRITE_TIMEOUT_SEC="20"
APP_SHUTDOWN_TIMEOUT_SEC="10"

# Default list size used by running endpoints when client does not pass limit.
APP_DEFAULT_RUNNING_LIMIT="50"

# Default customer id for some report views.
APP_DEFAULT_CUSTOMER_ID="default"

# -----------------------------------------------------------------------------
# Archivematica MCP database (read-only)
# -----------------------------------------------------------------------------

# Enable MCP DB-backed features (transfers, SIPs, troubleshooting, reports).
APP_DB_ENABLED="false"

# MCP MySQL connection settings.
APP_DB_HOST="127.0.0.1"
APP_DB_PORT="62001"
APP_DB_USER="archivematica"
APP_DB_NAME="MCP"
APP_DB_CONN_TIMEOUT_SEC="5"
APP_DB_QUERY_TIMEOUT_SEC="10"

# Running item is considered stalled after this many minutes.
APP_RUNNING_STUCK_MINUTES="30"

# Local SQLite file used only by this app (report templates and app mappings).
APP_CUSTOMER_MAP_SQLITE_PATH="/var/lib/am-ops-observer/customer-mappings.db"

# -----------------------------------------------------------------------------
# Storage Service database (read-only)
# -----------------------------------------------------------------------------

# Enable SS DB enrichment (package/location/path info).
APP_SS_DB_ENABLED="false"

# SS MySQL connection settings.
APP_SS_DB_HOST="127.0.0.1"
APP_SS_DB_PORT="62001"
APP_SS_DB_USER="archivematica"
APP_SS_DB_NAME="SS"
APP_SS_DB_CONN_TIMEOUT_SEC="5"
APP_SS_DB_QUERY_TIMEOUT_SEC="10"

# -----------------------------------------------------------------------------
# Prometheus scrape settings
# -----------------------------------------------------------------------------

# Enable direct scraping of AM/SS/service metrics targets.
APP_PROM_ENABLED="true"

# Comma-separated list of full /metrics URLs.
# Typical all-in-one AM example:
APP_PROM_TARGETS="http://127.0.0.1:62991/metrics,http://127.0.0.1:62992/metrics,http://127.0.0.1:62080/metrics,http://127.0.0.1:62081/metrics"

# Prefix filter used in live metrics views.
APP_PROM_MATCH_PREFIX="mcp"

# Prometheus polling/sampling controls.
APP_PROM_SCRAPE_TIMEOUT_SEC="5"
APP_PROM_SCRAPE_INTERVAL_SEC="15"
APP_PROM_HISTORY_MAX_POINTS="720"

# -----------------------------------------------------------------------------
# Elasticsearch settings (read-only)
# -----------------------------------------------------------------------------

# Enable AIP search/stats from Elasticsearch index.
APP_ES_ENABLED="true"

# Elasticsearch endpoint and request controls.
APP_ES_ENDPOINT="http://127.0.0.1:62002"
APP_ES_TIMEOUT_SEC="5"
APP_ES_LOOKUP_LIMIT="5"

# AIP index name and pagination size.
APP_ES_AIP_INDEX="aipfiles"
APP_ES_AIP_PAGE_SIZE="500"

# -----------------------------------------------------------------------------
# Risk indicator thresholds (AIP quality panel)
# -----------------------------------------------------------------------------
# These tune red/green hotspot flags only; they do not alter source data.

APP_RISK_UNKNOWN_HOT_RATE="0.01"
APP_RISK_UNKNOWN_HOT_ABS="5"
APP_RISK_MISSING_IDS_HOT_RATE="0.10"
APP_RISK_MISSING_IDS_HOT_ABS="20"
APP_RISK_MISSING_CREATED_HOT_RATE="0.10"
APP_RISK_MISSING_CREATED_HOT_ABS="20"
APP_RISK_EXT_MISMATCH_HOT_RATE="0.02"
APP_RISK_EXT_MISMATCH_HOT_ABS="10"
APP_RISK_DUP_FILES_HOT_RATE="0.20"
APP_RISK_DUP_FILES_HOT_ABS="50"
APP_RISK_DUP_GROUPS_HOT_ABS="20"
APP_RISK_INDEX_LAG_P95_HOT_SEC="1800"
APP_RISK_MIN_DIVERSITY_RATIO="0.02"
APP_RISK_TINY_FILES_MAX="20"
APP_RISK_MIN_UNIQUE_FORMATS="2"
APP_RISK_MIN_UNIQUE_FORMATS_TINY="1"
